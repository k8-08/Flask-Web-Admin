# 快速测试指南 - 强制下线弹窗

## 🎯 测试目标

验证用户被强制下线后能看到弹窗提示并跳转到登录页。

## 📋 测试步骤

### 步骤1: 准备环境

1. **确保服务运行**：
   - 后端服务：http://127.0.0.1:8100
   - 前端服务：http://localhost:5173（或其他端口）
   - Redis 服务正在运行

2. **打开两个浏览器窗口**：
   - 窗口A（管理员）
   - 窗口B（被下线用户）

### 步骤2: 登录

1. **窗口A**：
   - 访问前端地址
   - 使用 admin / 123456 登录

2. **窗口B**：
   - 访问前端地址（可以用隐私模式或不同浏览器）
   - 使用 admin / 123456 登录（同一账号）
   - **重要**：打开开发者工具（F12），切换到 Console 标签页

### 步骤3: 执行强制下线

1. **窗口A**：
   - 点击左侧菜单："系统监控" → "在线用户"
   - 应该看到2个在线用户（或1个，如果登录时清理了旧会话）
   - 找到窗口B的用户记录
   - 点击"下线"按钮
   - 确认下线

2. **窗口A 预期结果**：
   - 看到成功提示："用户已强制下线"
   - 在线用户列表中该用户消失

### 步骤4: 观察窗口B

1. **窗口B**：
   - 进行任何操作（如点击菜单、刷新页面、访问其他页面）

2. **窗口B 预期结果**：
   - 🎉 **看到弹窗**："您已被强制下线，请重新登录\n\n页面将跳转到登录页，请重新登录"
   - 弹窗只有一个"确定"按钮
   - 控制台显示日志：
     ```
     [强制下线] 检测到强制下线消息: 您已被强制下线，请重新登录
     [强制下线] 准备显示弹窗
     [强制下线] 显示弹窗
     [强制下线] 清除 Session 并跳转到登录页
     ```
   - 点击"确定"后自动跳转到登录页

## ✅ 成功标准

- [ ] 窗口B看到弹窗提示
- [ ] 弹窗内容包含"强制下线"和"重新登录"
- [ ] 控制台有完整的日志输出
- [ ] 点击确定后跳转到登录页
- [ ] Session 被清除（需要重新输入密码）

## ❌ 如果测试失败

### 情况1: 没有看到弹窗

**检查**：
1. 打开浏览器控制台（F12），查看 Console 标签页
2. 查看是否有 `[强制下线]` 开头的日志
3. 如果有日志但没弹窗，可能是浏览器禁用了弹窗

**解决**：
- 检查浏览器设置，允许弹窗
- 尝试在控制台手动执行：`window.alert('测试')`

### 情况2: 看到日志但没有跳转

**检查**：
1. 查看控制台是否有错误
2. 检查 Network 标签页，查看 401 请求

**解决**：
- 刷新页面重试
- 清除浏览器缓存

### 情况3: 没有任何反应

**检查**：
1. Network 标签页，查看是否有 401 请求
2. 如果没有 401，说明黑名单没生效

**解决**：
- 检查 Redis 是否正常运行
- 检查后端日志是否有错误
- 运行后端测试脚本：`python backend/test_force_offline_complete.py`

## 🔧 调试工具

### 1. 测试原生弹窗

在浏览器控制台执行：
```javascript
window.alert('测试弹窗\n\n这是第二行');
```

如果这个弹窗能显示，说明浏览器支持原生弹窗。

### 2. 测试完整流程

打开测试页面：
```
frontend/test-force-offline-simple.html
```

点击各个测试按钮，验证弹窗功能。

### 3. 查看 Redis 黑名单

在 Redis 客户端执行：
```bash
redis-cli
> KEYS session_blacklist:*
> GET session_blacklist:你的session_id
```

应该能看到黑名单记录。

## 📞 需要帮助？

如果测试仍然失败，请提供以下信息：

1. **浏览器控制台截图**（Console 标签页）
2. **网络请求截图**（Network 标签页，401 请求的详情）
3. **实际看到的现象描述**
4. **使用的浏览器和版本**

参考详细调试指南：`frontend/FORCE_OFFLINE_DEBUG_STEPS.md`
